var GoL={init:function(a,b){this.size=b.size;this.canvas=document.createElement("canvas");this.buffer=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.buffer_context=this.buffer.getContext("2d");this.element=$(a);this.element.data("gol",this);this.element.append(this.canvas);$(this.canvas).attr("id","gol_container");this.innerWidth=window.innerWidth;this.innerHeight=window.innerHeight;this.alive=[];this.candidates=[];this.colors=b.colors||"#fff,#A6BABB,#667B80,#5979A8,#a6babb,#ded13f,#A68F8E".split(",");
this.adjustDimensions(this.size,this.size);this.initializeGrid(this.rows,this.columns);this.randomnizeGrid();this.enableControls();this.startLoop(b.speed)},initializeGrid:function(a,b){var c=Array(a);for(i=0;i<a;i++)c[i]=Array(b);this.grid=c},randomnizeGrid:function(){var a=Math.floor,b=Math.random,c=40*this.size,d,e;this.alive=[];this.candidates=[];for(i=0;i<c;i++)d=a(b()*this.rows),e=a(b()*this.columns),this.grid[d][e]=10,this.alive.push([d,e])},adjustDimensions:function(a,b){var c=Math.floor;this.squares_margin=
1;this.min_offset=this.squares_margin+1;this.square_offset=Math.max(c($(document).width()/b),this.min_offset);this.square_size=this.square_offset-this.squares_margin;this.canvas.width=this.innerWidth;this.canvas.height=this.innerHeight;this.buffer.width=this.innerWidth;this.buffer.height=this.innerHeight;this.columns=c($(document).height()/this.square_offset);this.rows=c($(document).width()/this.square_offset)},enableControls:function(){var a=this;$("#reset").click(function(){a.adjustDimensions(a.size,
a.size);a.initializeGrid(a.rows,a.columns);a.randomnizeGrid()});$("#speed a").click(function(){a.changeSpeed($(this).attr("data-speed"))});$("#size a").click(function(){var b=parseInt($(this).attr("data-size"));if(250>=b||confirm("Seriously? This may bring your cpu to it's knees.\nIt's super cool though."))a.size=b,a.adjustDimensions(a.size,a.size),a.initializeGrid(a.rows,a.columns),a.randomnizeGrid()});$(".max_size").click(function(){$(".insane_size").show()})},run:function(){this.canvas.width=this.innerWidth;
this.buffer.width=this.innerWidth;this.nextGeneration();this.renderGrid()},startLoop:function(a){this.interval=setInterval(function(a){a.run()},a,this)},changeSpeed:function(a){clearInterval(this.interval);this.startLoop(a)},renderCell:function(a,b){var c=a*this.square_offset+this.squares_margin,d=b*this.square_offset+this.squares_margin;this.buffer_context.fillStyle=this.colors[Math.min(this.grid[a][b]/10,6)];this.buffer_context.fillRect(c,d,this.square_size,this.square_size)},renderGrid:function(){this.context.drawImage(this.buffer,
0,0)},nextGeneration:function(){var a=this.grid,b=this.alive.length,c,d,e,f;this.candidates=this.alive;for(c=0;c<b;c++)this.updateNeighbours(this.alive[c]);this.alive=[];var g=this.candidates.length;for(c=0;c<g;c++)b=this.candidates[c][0],d=this.candidates[c][1],e=a[b][d],10<=e?(f=e%10,2>f||3<f?a[b][d]=void 0:(a[b][d]=e-f,60>a[b][d]&&(a[b][d]+=10),this.renderCell(b,d),this.alive.push(this.candidates[c]))):3==e?(a[b][d]=10,this.renderCell(b,d),this.alive.push(this.candidates[c])):a[b][d]=void 0;this.candidates=
[]},updateNeighbours:function(a){for(var b=a[0],a=a[1],c,d=[[b-1,a-1],[b-1,a],[b-1,a+1],[b,a-1],[b,a+1],[b+1,a-1],[b+1,a],[b+1,a+1]],b=0;8>b;b++)0<=d[b][0]&&d[b][0]<this.rows&&0<=d[b][1]&&d[b][1]<this.columns&&(a=d[b][0],c=d[b][1],this.grid[a][c]?this.grid[a][c]++:this.grid[a][c]=1,1==this.grid[a][c]&&this.candidates.push(d[b]))}};$(document).ready(function(){GoL.init($("#gol"),{size:150,speed:100});$("#enjoy_the_show").click(function(){$("footer, .controls, #fork_me").fadeIn("slow");$("#info_container").fadeOut("slow");$("#gol_container").animate({opacity:1},3E3)})});
